spring:
  cloud:
    gateway:
      server:
        webflux:
          globalcors:
            cors-configurations:
              '[/**]':
                allowedOrigins:
                  - "http://localhost:5173"
                  - "http://localhost:3000"
                allowedOriginPatterns:
                  - "*"
                allowedMethods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - OPTIONS
                allowedHeaders:
                  - "*"
                exposedHeaders:
                  - "Set-Cookie"
                  - "X-XSRF-TOKEN"
                  - "Authorization"
                allowCredentials: true


          routes:
            - id: book-service
              uri: http://localhost:8081
              predicates:
                - Path=/books/**
              filters:
                - RewritePath=/books/(?<segment>.*), /${segment}

            - id: user-service
              uri: http://localhost:8082
              predicates:
                - Path=/user/**
              filters:
                - RewritePath=/user/(?<segment>.*), /${segment}

            - id: auth-service
              uri: http://127.0.0.1:9000
              predicates:
                - Path=/auth/**
              filters:
                - RewritePath=/auth/(?<segment>.*), /${segment}

            - id: pizza-service
              uri: http://localhost:8083
              predicates:
                - Path=/pizza/**
              filters:
                - RewritePath=/pizza/(?<segment>.*), /${segment}

#            - id: book-service
#              uri: http://localhost:8081
#              predicates:
#                - Path=/books/**
#              filters:
#                - TokenRelay
#  platform-auth-server:
#    issuer-uri: http://127.0.0.1:9000
#  security:
#    oauth2:
#      client:
#        provider:
#          platform-auth-server:
#            issuer-uri: http://127.0.0.1:9000
#        registration:
#          gateway-client:
#            provider: platform-auth-server
#            client-id: gateway-client
#            client-secret: "secret"
#            client-authentication-method: client_secret_post
#            authorization-grant-type: authorization_code
#            redirect-uri: http://localhost:8080/login/oauth2/code/gateway-client
#            scope:
#              - openid
#              - profile
#              - email
logging:
  level:
    org.springframework.web.filter.CorsFilter: DEBUG
